<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Pro System | Ù†Ø¸Ø§Ù… Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (Cairo) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Light Mode Variables */
            --bg-body: #f3f4f6;
            --bg-sidebar: #1e293b; 
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --primary-color: #3b82f6;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --bg-body: #0f172a; 
            --bg-sidebar: #1e293b;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --primary-color: #60a5fa;
            --input-bg: #334155;
            --input-border: #475569;
        }

        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar { 
            min-height: 100vh; 
            background: var(--bg-sidebar); 
            color: #e2e8f0; 
            position: fixed;
            width: 260px;
            z-index: 1000;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar-header {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            text-align: center;
        }
        .sidebar a { 
            color: #94a3b8; 
            text-decoration: none; 
            display: flex;
            align-items: center;
            padding: 16px 25px; 
            transition: 0.3s; 
            border-right: 4px solid transparent;
            font-weight: 600;
        }
        .sidebar a:hover { 
            background: rgba(255,255,255,0.05); 
            color: #fff; 
        }
        .sidebar a.active { 
            background: rgba(59, 130, 246, 0.1); 
            color: #60a5fa; 
            border-right: 4px solid #60a5fa; 
        }
        .sidebar i { width: 30px; }

        /* Main Content */
        .main-content { margin-right: 260px; padding: 30px; transition: margin-right 0.3s; }
        
        /* Card Styling */
        .card { 
            background-color: var(--bg-card); 
            border: 1px solid var(--border-color); 
            border-radius: 16px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            color: var(--text-main);
        }
        
        /* Stats Cards */
        .stat-card { 
            border: none; 
            color: white; 
            position: relative; 
            overflow: hidden; 
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card .icon-bg {
            position: absolute;
            left: -10px;
            bottom: -10px;
            font-size: 5rem;
            opacity: 0.2;
            transform: rotate(15deg);
        }

        /* Inputs & Tables in Dark Mode */
        .form-control {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-main);
        }
        .form-control:focus {
            background-color: var(--input-bg);
            color: var(--text-main);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.25);
        }
        .table { color: var(--text-main); }
        .table-hover tbody tr:hover { color: var(--text-main); background-color: rgba(0,0,0,0.05); }
        [data-theme="dark"] .table-hover tbody tr:hover { background-color: rgba(255,255,255,0.05); }

        /* Product & Cart */
        .product-card { 
            cursor: pointer; 
            transition: 0.2s; 
            border: 2px solid transparent;
            overflow: hidden;
        }
        .product-card:hover { 
            border-color: var(--primary-color); 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .product-img-container {
            height: 140px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .product-img { max-height: 120px; max-width: 100%; mix-blend-mode: multiply; }
        [data-theme="dark"] .product-img { mix-blend-mode: normal; }
        [data-theme="dark"] .product-img-container { background: #334155; }

        .cart-item { 
            background: var(--bg-body); 
            border-radius: 8px; 
            padding: 10px; 
            margin-bottom: 8px; 
            border: 1px solid var(--border-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(100%); transition: transform 0.3s; }
            .sidebar.show { transform: translateX(0); }
            .main-content { margin-right: 0; padding: 15px; }
        }
        
        .d-none-custom { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<!-- Navbar (Mobile Toggle) -->
<nav class="navbar navbar-dark bg-dark sticky-top d-md-none p-3">
    <div class="d-flex justify-content-between w-100">
        <span class="navbar-brand fw-bold">Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø±Ùˆ</span>
        <button class="btn btn-outline-light" onclick="toggleSidebar()">
            <i class="fa-solid fa-bars"></i>
        </button>
    </div>
</nav>

<!-- Sidebar -->
<div class="sidebar d-flex flex-column" id="sidebar">
    <div class="sidebar-header">
        <h4 class="fw-bold mb-0"><i class="fa-brands fa-apple me-2"></i> iShop Pro</h4>
    </div>
    <div class="flex-grow-1 mt-4">
        <a href="#" onclick="app.navigate('dashboard')" id="link-dashboard" class="active">
            <i class="fa-solid fa-chart-pie"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </a>
        <a href="#" onclick="app.navigate('pos')" id="link-pos">
            <i class="fa-solid fa-cash-register"></i> Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (POS)
        </a>
        <a href="#" onclick="app.navigate('maintenance')" id="link-maintenance">
            <i class="fa-solid fa-screwdriver-wrench"></i> Ø§Ù„ØµÙŠØ§Ù†Ø©
        </a>
        <a href="#" onclick="app.navigate('inventory')" id="link-inventory">
            <i class="fa-solid fa-boxes-stacked"></i> Ø§Ù„Ù…Ø®Ø²Ù†
        </a>
    </div>
    
    <!-- Theme Toggle at Bottom -->
    <div class="p-4 border-top border-secondary">
        <div class="d-flex justify-content-between align-items-center">
            <span class="small"><i class="fa-solid fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</span>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="darkModeSwitch" onchange="app.toggleTheme()">
            </div>
        </div>
    </div>
</div>

<!-- Main Content Area -->
<div class="main-content">
    
    <!-- 1. DASHBOARD -->
    <div id="section-dashboard" class="fade-in">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3 class="fw-bold">ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±ØŒ Ø£Ø¯Ù…Ù† ğŸ‘‹</h3>
                <p class="text-muted mb-0">Ø¥Ù„ÙŠÙƒ Ù…Ù„Ø®Øµ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„ÙŠÙˆÙ….</p>
            </div>
            <button class="btn btn-primary" onclick="app.navigate('pos')"><i class="fa-solid fa-plus"></i> Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card stat-card bg-primary p-4 h-100">
                    <i class="fa-solid fa-sack-dollar icon-bg"></i>
                    <h5>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h5>
                    <h2 class="fw-bold mt-2">12,500 <span class="fs-6">Ø¬.Ù…</span></h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-success p-4 h-100">
                    <i class="fa-solid fa-check-circle icon-bg"></i>
                    <h5>Ø£Ø¬Ù‡Ø²Ø© ØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡Ø§</h5>
                    <h2 class="fw-bold mt-2" id="dash-maintenance-count">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-warning p-4 h-100 text-dark">
                    <i class="fa-solid fa-box-open icon-bg text-dark"></i>
                    <h5>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h5>
                    <h2 class="fw-bold mt-2" id="dash-stock-count">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-danger p-4 h-100">
                    <i class="fa-solid fa-triangle-exclamation icon-bg"></i>
                    <h5>Ù†ÙˆØ§Ù‚Øµ</h5>
                    <h2 class="fw-bold mt-2">3</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card p-4 h-100">
                    <h5 class="fw-bold mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)</h5>
                    <div style="height: 300px; position: relative;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-4 h-100">
                    <h5 class="fw-bold mb-4">Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
                            <span><i class="fa-solid fa-mobile text-primary me-2"></i> iPhone 14</span>
                            <span class="badge bg-success rounded-pill">ØªÙ… Ø§Ù„Ø¨ÙŠØ¹</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. POS SECTION -->
    <div id="section-pos" class="d-none-custom fade-in">
        <div class="row h-100">
            <!-- Products -->
            <div class="col-lg-8 mb-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="fw-bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                    <div class="input-group w-50">
                        <span class="input-group-text bg-transparent border-end-0"><i class="fa-solid fa-search"></i></span>
                        <input type="text" class="form-control border-start-0" placeholder="Ø¨Ø­Ø«..." onkeyup="app.filterProducts(this.value)">
                    </div>
                </div>
                <div class="row g-3" id="product-grid"></div>
            </div>
            
            <!-- Cart -->
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0"><i class="fa-solid fa-cart-shopping me-2"></i> Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
                    </div>
                    <div class="card-body p-3 d-flex flex-column">
                        <div id="cart-items" style="flex-grow: 1; overflow-y: auto; max-height: 50vh;">
                            <div class="text-center text-muted py-5">
                                <i class="fa-solid fa-basket-shopping fa-3x mb-3 opacity-50"></i>
                                <p>Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ø§Øª Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§</p>
                            </div>
                        </div>
                        
                        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± -->
                        <div class="mt-auto border-top pt-3">
                            
                            <!-- ğŸŸ¢ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø±Ø§Ø± Ø¥Ù„Ù‰ Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… -->
                            <button class="btn btn-outline-danger w-100 mb-2" onclick="app.addDiscount()">
                                <i class="fa-solid fa-percent"></i> Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…
                            </button>

                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                                <span class="fw-bold" id="cart-subtotal">0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="fs-5 fw-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                                <span class="fs-4 fw-bold text-primary" id="cart-total">0.00 Ø¬.Ù…</span>
                            </div>
                            <button class="btn btn-success w-100 py-3 fw-bold shadow-sm" onclick="app.checkout()">
                                <i class="fa-brands fa-whatsapp me-2"></i> Ø·Ø¨Ø§Ø¹Ø© ÙˆØ¥Ø±Ø³Ø§Ù„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. MAINTENANCE SECTION -->
    <div id="section-maintenance" class="d-none-custom fade-in">
        <h3 class="fw-bold mb-4">ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h3>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 bg-opacity-10 bg-primary border-primary border-top border-4">
                    <div class="card-header bg-transparent fw-bold text-primary">ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… (Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ)</div>
                    <div class="card-body p-2" id="col-received"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 bg-opacity-10 bg-warning border-warning border-top border-4">
                    <div class="card-header bg-transparent fw-bold text-warning">âš™ï¸ Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</div>
                    <div class="card-body p-2" id="col-progress"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 bg-opacity-10 bg-success border-success border-top border-4">
                    <div class="card-header bg-transparent fw-bold text-success">âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…)</div>
                    <div class="card-body p-2" id="col-done"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. INVENTORY SECTION -->
    <div id="section-inventory" class="d-none-custom fade-in">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</h3>
            <button class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#addProductModal">
                <i class="fa-solid fa-plus me-2"></i> ØµÙ†Ù Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="p-3">ID</th>
                                <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- MODAL -->
<div class="modal fade" id="addProductModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="mb-3">
                        <label class="form-label text-muted">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" id="newProdName" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Samsung A54">
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label text-muted">Ø§Ù„Ø³Ø¹Ø±</label>
                            <input type="number" id="newProdPrice" class="form-control" placeholder="0.00">
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label text-muted">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                            <input type="number" id="newProdStock" class="form-control" value="1">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary px-4" onclick="app.addProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
<button class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center" 
        onclick="toggleCalculator()"
        style="position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; z-index: 9999; font-size: 25px;">
    <i class="fa-solid fa-calculator"></i>
</button>

<div id="floating-calc" class="card shadow-lg border-0" 
     style="position: fixed; bottom: 90px; left: 20px; width: 280px; z-index: 9999; display: none; background: var(--bg-card); border-radius: 15px;">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <span class="small fw-bold">Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©</span>
        <button class="btn btn-sm btn-link text-white p-0" onclick="toggleCalculator()"><i class="fa-solid fa-times"></i></button>
    </div>
    <div class="card-body p-2">
        <input type="text" id="calc-display" class="form-control mb-2 text-end fs-4 fw-bold" readonly style="background: var(--bg-body); border:none;" value="">
        <div class="row g-1">
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('7')">7</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('8')">8</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('9')">9</button></div>
            <div class="col-3"><button class="btn btn-warning w-100" onclick="calcInput('/')">Ã·</button></div>
            
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('4')">4</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('5')">5</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('6')">6</button></div>
            <div class="col-3"><button class="btn btn-warning w-100" onclick="calcInput('*')">Ã—</button></div>
            
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('1')">1</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('2')">2</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('3')">3</button></div>
            <div class="col-3"><button class="btn btn-warning w-100" onclick="calcInput('-')">-</button></div>
            
            <div class="col-3"><button class="btn btn-danger w-100" onclick="document.getElementById('calc-display').value=''">C</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="calcInput('0')">0</button></div>
            <div class="col-3"><button class="btn btn-success w-100" onclick="calcResult()">=</button></div>
            <div class="col-3"><button class="btn btn-warning w-100" onclick="calcInput('+')">+</button></div>
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ğŸŸ¢ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
function toggleCalculator() {
    const calc = document.getElementById('floating-calc');
    calc.style.display = calc.style.display === 'none' ? 'block' : 'none';
}
function calcInput(val) { document.getElementById('calc-display').value += val; }
function calcResult() {
    try { document.getElementById('calc-display').value = eval(document.getElementById('calc-display').value); }
    catch { document.getElementById('calc-display').value = 'Error'; }
}

// ğŸŸ¢ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
const app = {
    // 1. DATA
    state: {
        products: [
            { id: 1, name: 'iPhone 14 Pro Max', price: 45000, stock: 5, img: 'https://placehold.co/200x200/3b82f6/ffffff?text=iPhone+14' },
            { id: 2, name: 'Samsung S23 Ultra', price: 38000, stock: 3, img: 'https://placehold.co/200x200/10b981/ffffff?text=Samsung+S23' },
            { id: 3, name: 'Xiaomi Note 12', price: 8500, stock: 10, img: 'https://placehold.co/200x200/f59e0b/ffffff?text=Xiaomi' },
            { id: 4, name: 'AirPods Pro 2', price: 9000, stock: 15, img: 'https://placehold.co/200x200/6366f1/ffffff?text=AirPods' },
            { id: 5, name: 'Anker Charger 20W', price: 800, stock: 50, img: 'https://placehold.co/200x200/ef4444/ffffff?text=Charger' },
        ],
        cart: [],
        maintenance: [
            { id: 101, device: 'iPhone X', client: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯', issue: 'ØªØºÙŠÙŠØ± Ø´Ø§Ø´Ø©', status: 'received' },
            { id: 102, device: 'Oppo Reno 6', client: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', issue: 'Ø³ÙˆÙƒØª Ø´Ø­Ù†', status: 'progress' },
            { id: 103, device: 'Lenovo Tab', client: 'Ø´Ø±ÙƒØ© Ø§Ù„Ù†ÙˆØ±', issue: 'Ø³ÙˆÙØª ÙˆÙŠØ±', status: 'done' },
        ],
        chartInstance: null
    },

    init: function() {
        this.renderDashboardChart();
        this.renderInventory();
        this.renderProducts();
        this.renderMaintenance();
        this.updateStats();
        
        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('show');
    },

    navigate: function(sectionId) {
        ['dashboard', 'pos', 'maintenance', 'inventory'].forEach(id => {
            document.getElementById(`section-${id}`).classList.add('d-none-custom');
            document.getElementById(`link-${id}`).classList.remove('active');
        });
        document.getElementById(`section-${sectionId}`).classList.remove('d-none-custom');
        document.getElementById(`link-${sectionId}`).classList.add('active');
        if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('show');
    },

    // --- POS & CART ---
    renderProducts: function(filterText = '') {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = '';
        
        this.state.products
            .filter(p => p.name.toLowerCase().includes(filterText.toLowerCase()))
            .forEach(p => {
                grid.innerHTML += `
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card product-card h-100 p-2" onclick="app.addToCart(${p.id})">
                            <div class="product-img-container">
                                <img src="${p.img}" class="product-img">
                            </div>
                            <div class="card-body p-2 text-center">
                                <h6 class="fw-bold mb-1 fs-6">${p.name}</h6>
                                <div class="text-primary fw-bold">${p.price.toLocaleString()} Ø¬.Ù…</div>
                                <span class="badge bg-light text-secondary border mt-2">Ù…Ø®Ø²ÙˆÙ†: ${p.stock}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
    },

    addToCart: function(productId) {
        const product = this.state.products.find(p => p.id === productId);
        this.state.cart.push({ ...product, cartId: Date.now(), imei: '' });
        this.renderCart();
        
        const Toast = Swal.mixin({ toast: true, position: 'bottom-start', showConfirmButton: false, timer: 1500, background: 'var(--bg-card)', color: 'var(--text-main)' });
        Toast.fire({ icon: 'success', title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©' });
    },

    // ğŸŸ¢ Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ØµÙ… (Ù…Ø¨Ù„Øº Ø£Ùˆ Ù†Ø³Ø¨Ø©)
    addDiscount: function() {
        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø³Ù„Ø©
        const currentTotal = this.state.cart.reduce((sum, item) => sum + item.price, 0);
        if (currentTotal <= 0) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ù…Ù„ Ø®ØµÙ… Ø¹Ù„Ù‰ Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'warning');

        // 2. Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…
        Swal.fire({
            title: 'Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…',
            html: `
                <div class="mb-3">
                    <label class="form-label fw-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…</label>
                    <input id="disc-val" type="number" class="form-control text-center fs-5" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‡Ù†Ø§">
                </div>
                <div class="d-flex justify-content-center gap-4">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="discType" id="type-fixed" value="fixed" checked>
                        <label class="form-check-label" for="type-fixed">Ù…Ø¨Ù„Øº (Ø¬.Ù…)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="discType" id="type-percent" value="percent">
                        <label class="form-check-label" for="type-percent">Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (%)</label>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…',
            cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            preConfirm: () => {
                const val = parseFloat(document.getElementById('disc-val').value);
                const type = document.querySelector('input[name="discType"]:checked').value;
                if (!val || val <= 0) Swal.showValidationMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©');
                return { val, type };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const { val, type } = result.value;
                let discountAmount = 0;
                let discountName = '';

                if (type === 'percent') {
                    if (val > 100) return Swal.fire('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ²ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¹Ù† 100%', 'error');
                    // Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    discountAmount = (currentTotal * val) / 100;
                    discountName = `Ø®ØµÙ… (${val}%)`;
                } else {
                    if (val > currentTotal) return Swal.fire('Ø®Ø·Ø£', 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'error');
                    discountAmount = val;
                    discountName = `Ø®ØµÙ… Ø®Ø§Øµ`;
                }

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ØµÙ… ÙƒØ¨Ù†Ø¯ Ø³Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
                this.state.cart.push({
                    id: 88888, // ÙƒÙˆØ¯ Ù…Ù…ÙŠØ² Ù„Ù„Ø®ØµÙ…
                    name: discountName,
                    price: -Math.abs(discountAmount), // Ù†ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ Ø³Ø§Ù„Ø¨
                    stock: 1,
                    imei: 'N/A', // Ù…Ø´ Ù…Ø­ØªØ§Ø¬ Ø³ÙŠØ±ÙŠØ§Ù„
                    cartId: Date.now()
                });
                
                this.renderCart();
                const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
                Toast.fire({ icon: 'success', title: 'ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…' });
            }
        });
    },

    renderCart: function() {
        const container = document.getElementById('cart-items');
        const totalEl = document.getElementById('cart-total');
        const subEl = document.getElementById('cart-subtotal');
        
        if (this.state.cart.length === 0) {
            container.innerHTML = '<div class="text-center text-muted py-5"><i class="fa-solid fa-basket-shopping fa-3x mb-3 opacity-25"></i><p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p></div>';
            totalEl.innerText = '0.00 Ø¬.Ù…';
            subEl.innerText = '0.00';
            return;
        }

        let html = '';
        let total = 0;

        this.state.cart.forEach((item, index) => {
            total += item.price;
            
            // ğŸŸ¢ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† Ù‡Ù†Ø§ (Ù„Ùˆ Ø³Ø§Ù„Ø¨ ÙŠØ¨Ù‚Ù‰ Ø£Ø­Ù…Ø±)
            const priceClass = item.price < 0 ? 'text-danger' : 'text-primary';
            
            html += `
                <div class="cart-item fade-in position-relative">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="fw-bold small">${item.name}</span>
                        <span class="${priceClass} fw-bold small" dir="ltr">${item.price.toLocaleString()}</span>
                    </div>
                    ${item.price > 0 ? `
                    <div class="input-group input-group-sm mb-1">
                        <span class="input-group-text bg-light"><i class="fa-solid fa-barcode"></i></span>
                        <input type="text" class="form-control" 
                               placeholder="Ø³ÙŠØ±ÙŠØ§Ù„ / IMEI (Ù…Ø·Ù„ÙˆØ¨)" 
                               value="${item.imei}" 
                               onchange="app.updateCartItem(${index}, 'imei', this.value)">
                    </div>` : ''}
                    <button class="btn btn-sm text-danger position-absolute top-0 end-0 mt-1" onclick="app.removeFromCart(${index})" style="font-size:10px">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            `;
        });

        container.innerHTML = html;
        totalEl.innerText = total.toLocaleString() + ' Ø¬.Ù…';
        subEl.innerText = total.toLocaleString();
    },

    updateCartItem: (index, key, value) => app.state.cart[index][key] = value,
    removeFromCart: (index) => { app.state.cart.splice(index, 1); app.renderCart(); },

    checkout: function() {
        if (this.state.cart.length === 0) return Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'warning');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙÙ‚Ø· (Ø³Ø¹Ø±Ù‡Ø§ Ù…ÙˆØ¬Ø¨)
        if (this.state.cart.some(item => item.price > 0 && item.imei.trim() === '')) {
            return Swal.fire({
                icon: 'warning',
                title: 'Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©',
                text: 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ (IMEI) Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù†',
            });
        }

        const total = this.state.cart.reduce((sum, item) => sum + item.price, 0);

        Swal.fire({
            title: 'ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹',
            text: `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toLocaleString()} Ø¬.Ù… - Ù‡Ù„ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø·Ø¨Ø§Ø¹Ø© ÙˆØ­ÙØ¸',
            cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            confirmButtonColor: '#25D366'
        }).then((res) => {
            if(res.isConfirmed) {
                this.printReceipt();
                this.state.cart = [];
                this.renderCart();
                const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
                Toast.fire({ icon: 'success', title: 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­' });
            }
        });
    },

    printReceipt: function() {
        const date = new Date().toLocaleString('ar-EG');
        const total = this.state.cart.reduce((sum, item) => sum + item.price, 0);
        
        let itemsHtml = '';
        this.state.cart.forEach(item => {
            itemsHtml += `
                <div class="item-row">
                    <div class="item-name">${item.name}</div>
                    ${item.imei && item.imei !== 'N/A' ? `<div class="item-imei">SN: ${item.imei}</div>` : ''}
                    <div class="item-price">
                        <span>${item.price.toLocaleString()}</span>
                    </div>
                </div>
            `;
        });

        const receiptWindow = window.open('', '', 'width=400,height=600');
        const receiptContent = `
            <html lang="ar" dir="rtl">
            <head>
                <title>ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</title>
                <style>
                    body { font-family: 'Courier New', monospace; margin: 0; padding: 10px; width: 80mm; background: #fff; color: #000; }
                    .header { text-align: center; margin-bottom: 10px; }
                    .logo { font-size: 20px; font-weight: bold; border: 2px solid #000; padding: 5px; display: inline-block; margin-bottom: 5px; }
                    .info { font-size: 12px; margin-bottom: 5px; }
                    .dashed-line { border-top: 1px dashed #000; margin: 10px 0; }
                    .item-row { margin-bottom: 8px; font-size: 12px; }
                    .item-name { font-weight: bold; }
                    .item-imei { font-size: 10px; color: #555; margin-right: 5px; }
                    .item-price { text-align: left; }
                    .total-section { text-align: center; font-size: 16px; font-weight: bold; margin-top: 10px; }
                    .footer { text-align: center; font-size: 10px; margin-top: 20px; }
                    .barcode { text-align: center; margin-top: 10px; font-family: 'Libre Barcode 39', cursive; font-size: 30px; }
                </style>
                <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+39&display=swap" rel="stylesheet">
            </head>
            <body>
                <div class="header">
                    <div class="logo">Mobile Pro</div>
                    <div class="info">Ø´Ø§Ø±Ø¹ Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ - ÙˆØ³Ø· Ø§Ù„Ø¨Ù„Ø¯</div>
                    <div class="info">Øª: 01000000000</div>
                    <div class="info">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}</div>
                    <div class="info">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: #${Date.now().toString().slice(-6)}</div>
                </div>
                <div class="dashed-line"></div>
                <div class="items-container">${itemsHtml}</div>
                <div class="dashed-line"></div>
                <div class="total-section">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toLocaleString()} Ø¬.Ù…</div>
                <div class="footer">
                    <p>Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¯ ÙˆÙ„Ø§ ÙŠØ³ØªØ¨Ø¯Ù„ Ø¥Ù„Ø§ Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ…</p>
                    <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…!</p>
                    <div class="barcode">*123456789*</div>
                </div>
                <script>window.onload = function() { window.print(); window.close(); }<\/script>
            </body>
            </html>
        `;
        receiptWindow.document.write(receiptContent);
        receiptWindow.document.close();
    },

    // --- MAINTENANCE ---
    renderMaintenance: function() {
        const cols = { received: 'col-received', progress: 'col-progress', done: 'col-done' };
        Object.values(cols).forEach(id => document.getElementById(id).innerHTML = '');

        this.state.maintenance.forEach(ticket => {
            const cardHtml = `
                <div class="card mb-2 shadow-sm border-0" style="cursor:pointer" onclick="app.moveTicket(${ticket.id})">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="fw-bold">${ticket.device}</span>
                            <span class="badge bg-light text-dark border">#${ticket.id}</span>
                        </div>
                        <div class="small text-muted mb-1"><i class="fa-solid fa-user me-1"></i> ${ticket.client}</div>
                        <div class="small text-danger"><i class="fa-solid fa-wrench me-1"></i> ${ticket.issue}</div>
                    </div>
                </div>
            `;
            document.getElementById(cols[ticket.status]).innerHTML += cardHtml;
        });
        this.updateStats();
    },

    moveTicket: function(id) {
        const t = this.state.maintenance.find(x => x.id === id);
        if(t.status === 'received') t.status = 'progress';
        else if(t.status === 'progress') t.status = 'done';
        this.renderMaintenance();
    },

    // --- INVENTORY ---
    renderInventory: function() {
        const tbody = document.getElementById('inventory-table');
        tbody.innerHTML = '';
        this.state.products.forEach(p => {
            tbody.innerHTML += `
                <tr>
                    <td class="text-muted">#${p.id}</td>
                    <td><img src="${p.img}" width="35" class="rounded"></td>
                    <td class="fw-bold">${p.name}</td>
                    <td>${p.price.toLocaleString()}</td>
                    <td><span class="badge ${p.stock<5?'bg-danger':'bg-success'}">${p.stock}</span></td>
                    <td><span class="badge bg-light text-dark border">Ù†Ø´Ø·</span></td>
                    <td><button class="btn btn-sm btn-light text-primary"><i class="fa-solid fa-pen"></i></button></td>
                </tr>
            `;
        });
        document.getElementById('dash-stock-count').innerText = this.state.products.length;
    },

    addProduct: function() {
        const name = document.getElementById('newProdName').value;
        const price = document.getElementById('newProdPrice').value;
        if(!name || !price) return;
        
        this.state.products.push({
            id: this.state.products.length + 1,
            name: name,
            price: parseFloat(price),
            stock: parseInt(document.getElementById('newProdStock').value),
            img: `https://placehold.co/200x200/3b82f6/ffffff?text=${name.substring(0,4)}`
        });
        
        bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
        this.renderInventory();
        this.renderProducts();
        Swal.fire({title: 'ØªÙ…', icon: 'success', toast: true, position: 'top', timer: 2000, showConfirmButton: false});
    },

    // --- CHART & THEME ---
    renderDashboardChart: function() {
        const ctx = document.getElementById('salesChart').getContext('2d');
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        const textColor = isDark ? '#94a3b8' : '#64748b';

        if(this.state.chartInstance) this.state.chartInstance.destroy();

        this.state.chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'],
                datasets: [{
                    label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                    data: [5000, 7000, 4500, 12000, 8000, 15000],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: textColor } } },
                scales: {
                    x: { ticks: { color: textColor }, grid: { display: false } },
                    y: { ticks: { color: textColor }, grid: { color: isDark ? '#334155' : '#e2e8f0' } }
                }
            }
        });
    },

    toggleTheme: function() {
        const body = document.body;
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
        } else {
            body.setAttribute('data-theme', 'dark');
        }
        this.renderDashboardChart();
    },

    updateStats: function() {
        document.getElementById('dash-maintenance-count').innerText = this.state.maintenance.filter(t => t.status === 'done').length;
    }
};

document.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>